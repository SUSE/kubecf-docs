<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.57.2" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Eirini Persistence broker | KubeCF</title><meta property="og:title" content="Eirini Persistence broker" />
<meta property="og:description" content="How to set-up KubeCF with Eirini and the persistence broker
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kubecf.io/docs/tutorials/eirini_persi/" />
<meta property="article:published_time" content="2020-09-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-09-02T14:20:57+02:00" /><meta property="og:site_name" content="KubeCF" />
<meta itemprop="name" content="Eirini Persistence broker">
<meta itemprop="description" content="How to set-up KubeCF with Eirini and the persistence broker
">


<meta itemprop="datePublished" content="2020-09-02T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-09-02T14:20:57&#43;02:00" />
<meta itemprop="wordCount" content="704">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Eirini Persistence broker"/>
<meta name="twitter:description" content="How to set-up KubeCF with Eirini and the persistence broker
"/>







<link rel="preload" href="/scss/main.min.a267473c50c1e3a3a293c7356bde2df7ef31dc904e49772ce6366a3703594ac5.css" as="style">
<link href="/scss/main.min.a267473c50c1e3a3a293c7356bde2df7ef31dc904e49772ce6366a3703594ac5.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>




  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1071.73 221.27"><defs><linearGradient id="a" x1="-424.28" y1="-348.73" x2="-423.28" y2="-348.73" gradientTransform="matrix(297.1, 0, 0, -297.1, 126823.42, -103498.81)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00b1e1"/><stop offset="1" stop-color="#2c75ba"/></linearGradient></defs><title>Asset 4</title><path d="M128.57 217.38 62.99 130.7 46.1 150.82v66.56H0V.83H46.1V97.58L122.72.83H179.54L93.5 102.45 185.38 217.38H128.57z"/><path d="M290.79 217.38v-19.8c-10.71 12-29.54 23.69-55.19 23.69-34.42.0-50.65-18.82-50.65-49.34V60.57h41.24v95.12c0 21.76 11.36 28.9 28.89 28.9 15.91.0 28.57-8.77 35.71-17.86V60.57H332V217.38z"/><path d="M358 217.38V.83h41.24V80.7c12.33-15.91 29.86-24 48.37-24 39.93.0 69.48 31.17 69.48 82.47.0 52.27-29.87 82.13-69.48 82.13-18.83.0-36-8.44-48.37-24v20.13zm76.62-32.79c24 0 39.94-18.18 39.94-45.45s-15.91-45.78-39.94-45.78c-13.31.0-28.57 7.79-35.38 18.18v55.52C406 177.12 421.3 184.59 434.61 184.59z"/><path d="M525.51 138.81c0-45.45 33.44-82.14 81.17-82.14 46.75.0 78.56 35.07 78.56 86.36v9.09H568.69c2.6 19.81 18.51 36.36 45.13 36.36 13.31.0 31.82-5.84 41.88-15.58l18.18 26.62c-15.58 14.29-40.25 21.75-64.61 21.75C561.55 221.27 525.51 189.13 525.51 138.81zm81.17-49.35C581 89.46 570 108.62 568 124.2h77.27C644.34 109.27 634 89.46 606.68 89.46z"/><path d="M964.59 87.19V74.01 41.42H1071.73V.83H918.49V217.38H964.59V175.15 127.78 87.19z"/><path d="M1041.05 90l-23.77-18.87V90h-139a45.54 45.54.0 0 1-31.52-12.64c-.48-.45-1-.91-1.42-1.39a45.78 45.78.0 1 0 0 66.27c.46-.47.94-.93 1.42-1.39a45.59 45.59.0 0 1 31.52-12.64h139v18.87l23.77-18.87 24.07-19.1z" fill="url(#a)"/><path d="M868.23 146A65.12 65.12.0 1 1 868 72.22L907.56 51.6a110.68 110.68.0 0 0-19.67-23.52c-.61.42-1.23.82-1.88 1.18A23.68 23.68.0 0 1 850.85 6.08a110 110 0 0 0-16.21-4.34A112 112 0 0 0 820.33.0c-.17.6-.36 1.19-.58 1.78a23.69 23.69.0 0 1-30.52 13.81 23.6 23.6.0 0 1-11.62-9.44 110.35 110.35.0 0 0-27.46 14.39 25.32 25.32.0 0 1 1.18 2.77 23.68 23.68.0 0 1-31.21 29.81 109.19 109.19.0 0 0-12 28.55 23.7 23.7.0 0 1 12.95 34.57 23.6 23.6.0 0 1-15.21 11 109.48 109.48.0 0 0 9.38 29.88 23.69 23.69.0 0 1 28.5 36.76 108.8 108.8.0 0 0 27 16.67 23.68 23.68.0 0 1 45.87 9 109.18 109.18.0 0 0 31.26-5.21 23.68 23.68.0 0 1 40.22-23.2 109.46 109.46.0 0 0 20-24c-.48-.35-.93-.76-1.39-1.15z"/></svg></span><span class="text-uppercase font-weight-bold">KubeCF</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/community/" ><span>Community</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.9dc6c902b1631f1d6fcc81bd48111a0e07aea2d955d0318f84d7c10fc5e853511c8ac4c48def76e2deedc1c9652023f23798c82de5da4233fdc50070d9f54343.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.9dc6c902b1631f1d6fcc81bd48111a0e07aea2d955d0318f84d7c10fc5e853511c8ac4c48def76e2deedc1c9652023f23798c82de5da4233fdc50070d9f54343.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/overview/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Overview</a>
  </li>
  <ul>
    <li class="collapse " id="docs-overview">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/deployment/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Deploying KubeCF</a>
  </li>
  <ul>
    <li class="collapse " id="docs-deployment">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-deployment-kubernetes-deploy" href="/docs/deployment/kubernetes-deploy/">Deployment Walkthrough</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-deployment-advanced-topics" href="/docs/deployment/advanced-topics/">Advanced Topics</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-deployment-affinities-and-tolerations" href="/docs/deployment/affinities-and-tolerations/">Affinities and Tolerations</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/concepts/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Concepts</a>
  </li>
  <ul>
    <li class="collapse " id="docs-concepts">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-concepts-operator" href="/docs/concepts/operator/">Operator</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-concepts-quarks" href="/docs/concepts/quarks/">Quarks</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tasks/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Core Tasks</a>
  </li>
  <ul>
    <li class="collapse " id="docs-tasks">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tasks-upgrade" href="/docs/tasks/upgrade/">KubeCF Upgrades</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tasks-deploy" href="/docs/tasks/deploy/">KubeCF Deployment guidelines</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tasks-secrets" href="/docs/tasks/secrets/">KubeCF and Secrets</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tasks-bosh" href="/docs/tasks/bosh/">Test BOSH Releases</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tutorials/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Tutorials</a>
  </li>
  <ul>
    <li class="collapse show" id="docs-tutorials">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-deploy-k3s" href="/docs/tutorials/deploy-k3s/">Deploy KubeCF on K3s</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-deploy-kind" href="/docs/tutorials/deploy-kind/">Deploy KubeCF on Kind</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-docs-tutorials-eirini-persi" href="/docs/tutorials/eirini_persi/">Eirini Persistence broker</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-deploy-stratos" href="/docs/tutorials/deploy-stratos/">Deploy Stratos next to KubeCF</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-bosh-integration" href="/docs/tutorials/bosh-integration/">Bosh releases integration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-deploy-minikube" href="/docs/tutorials/deploy-minikube/">Deploy KubeCF in Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-run-smoke-tests" href="/docs/tutorials/run-smoke-tests/">Run smoke tests</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/reference/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Reference</a>
  </li>
  <ul>
    <li class="collapse " id="docs-reference">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-reference-tests" href="/docs/reference/tests/">Tests</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/contribution-guidelines/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Contribution Guidelines</a>
  </li>
  <ul>
    <li class="collapse " id="docs-contribution-guidelines">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            






<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">





<a href="https://github.com/cloudfoundry-incubator/kubecf-docs/edit/master/content/en/docs/Tutorials/eirini_persi.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudfoundry-incubator/kubecf-docs/issues/new?title=Eirini%20Persistence%20broker" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/cloudfoundry-incubator/kubecf/issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>

</div>






<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#setup-eirini-persi-broker-with-kubecf">Setup eirini-persi-broker with KubeCF</a>
<ul>
<li><a href="#get-the-broker-password">Get the broker password</a></li>
<li><a href="#create-the-service-broker">Create the service broker</a></li>
<li><a href="#enable-the-service-for-the-space">Enable the service for the space</a></li>
</ul></li>
<li><a href="#using-the-eirini-persi-broker">Using the Eirini-persi broker</a>
<ul>
<li><a href="#create-a-service">Create a service</a></li>
<li><a href="#bind-volumes-to-a-cloud-foundry-application">Bind volumes to a Cloud Foundry application</a></li>
<li><a href="#access-the-volume">Access the Volume</a></li>
</ul></li>
<li><a href="#see-also">See also</a></li>
</ul></li>
</ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://kubecf.io/docs/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://kubecf.io/docs/tutorials/">Tutorials</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://kubecf.io/docs/tutorials/eirini_persi/">Eirini Persistence broker</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Eirini Persistence broker</h1>
    <div class="lead">How to set-up KubeCF with Eirini and the persistence broker</div>
	       
	

<p>KubeCF allows to leverage the Kubernetes Cluster available <code>StorageClass</code>. When Eirini is being enabled, two additional components are deployed, the <code>eirini-persi-extension</code> and <code>eirini-persi-broker</code>.</p>

<p>The broker must be configured in order to use the storageclass to provide support for persistence data for applications pushed to CloudFoundry with Eirini.</p>

<p>You can set up default plans that are applied to the broker during deployment.</p>

<p>To configure the broker, in the KubeCF values add and adjust as needed:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">eirinix:<span style="color:#666">
</span><span style="color:#666">  </span>persi-broker:<span style="color:#666">
</span><span style="color:#666">    </span>service-plans:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>id:<span style="color:#666"> </span>default<span style="color:#666">
</span><span style="color:#666">      </span>name:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;default&#34;</span><span style="color:#666">
</span><span style="color:#666">      </span>description:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;Existing default storage class&#34;</span><span style="color:#666">
</span><span style="color:#666">      </span>kube_storage_class:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;default&#34;</span><span style="color:#666"> </span><span style="color:#999;font-style:italic"># Storageclass used for provisioning</span><span style="color:#666">
</span><span style="color:#666">      </span>free:<span style="color:#666"> </span><span style="color:#6ab825;font-weight:bold">true</span><span style="color:#666">
</span><span style="color:#666">      </span>default_size:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;1Gi&#34;</span><span style="color:#666"> </span><span style="color:#999;font-style:italic"># Default size of generated PVC</span><span style="color:#666">
</span><span style="color:#666">      </span>default_access_mode:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;ReadWriteOnly&#34;</span><span style="color:#666"> </span><span style="color:#999;font-style:italic"># Here you can tweak the default access mode for new PVCs</span></code></pre></div>
<h2 id="setup-eirini-persi-broker-with-kubecf">Setup eirini-persi-broker with KubeCF</h2>

<p>In this section we will see how to setup the eirini-persi-broker on a KubeCF deployment.</p>

<h3 id="get-the-broker-password">Get the broker password</h3>

<p>After deploying KubeCF the broker password should be automatically generated (the example assumes you have deployed KubeCF in the <code>kubecf</code> namespace):</p>

<pre><code>$&gt; BROKER_PASS=$(kubectl get secrets -n kubecf -o json persi-broker-auth-password | jq -r '.data.&quot;password&quot;' | base64 -d)
</code></pre>

<h3 id="create-the-service-broker">Create the service broker</h3>

<p>With <code>cf-cli</code> (you must be logged in) let&rsquo;s add the broker to our cf instance:</p>

<pre><code>$&gt; cf create-service-broker eirini-persi admin $BROKER_PASS http://eirini-persi-broker:8999
</code></pre>

<h3 id="enable-the-service-for-the-space">Enable the service for the space</h3>

<p>Let&rsquo;s enable the service (here, doing it globally):</p>

<pre><code>$&gt; cf enable-service-access eirini-persi


Enabling access to all plans of service eirini-persi for all orgs as admin...
OK

</code></pre>

<p>Check everything is ok:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$&gt; cf service-brokers

Getting service brokers as admin...

name                  url
eirini-persi          http://eirini-persi-broker:8999</code></pre></div>
<p>If eirini-persi is showed among the list of the available brokers, it means that it is configured and plans supplied during deployment are available to be consumed.</p>

<p>Now the broker should be available in the marketplace, list all the broker services:</p>

<pre><code>$&gt; cf marketplace
Getting services from marketplace in org system / space tmp as admin...
OK

service        plans     description
eirini-persi   default   Eirini persistence broker
</code></pre>

<p>List the plans available from the broker (output might differ):</p>

<pre><code>$&gt; cf marketplace -s eirini-persi
Getting service plan information for service eirini-persi as admin...
OK

service plan   description                 free or paid
default        Eirini persistence broker   free
</code></pre>

<h2 id="using-the-eirini-persi-broker">Using the Eirini-persi broker</h2>

<p>To verify that everything works correctly it is possible to check after creating a service that the persistent volume claims are present in the Kubernetes cluster.</p>

<h3 id="create-a-service">Create a service</h3>

<p><code>eirini-persi-broker</code> will create PVCs associated to the services that are created:</p>

<pre><code>$&gt; cf create-service eirini-persi default eirini-persi-1
Creating service instance eirini-persi-1 in org system / space tmp as admin...
OK
</code></pre>

<p>In this way, we can associate the service to an app, which will actually link and attach a PVC to it.</p>

<p>List all the <code>PersistentVolumeClaim</code> and verify that a new one was created:</p>

<pre><code>$&gt; kubectl get pvc -n eirini
NAME                                   STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
f9d4b977-0b9e-4fcb-a92e-652bc77dd7e7   Bound    pvc-9960cc11-7895-11e9-afac-024267c84a6b   1Gi        RWO            persistent     6s

</code></pre>

<p>To create a service with a custom capacity, you can define the quota when creating the service.</p>

<p>E.g. create a service providing a volume with 20M of quota:</p>

<pre><code>$&gt; cf create-service eirini-persi default eirini-persi-1-20M-quota -c '{&quot;size&quot;: &quot;20M&quot;}'
</code></pre>

<p>E.g. To create a PVC which has a different access mode:</p>

<pre><code>$&gt; cf create-service eirini-persi default eirini-persi-1-rwm -c '{&quot;access_mode&quot;: &quot;ReadWriteMany&quot;}'
</code></pre>

<h3 id="bind-volumes-to-a-cloud-foundry-application">Bind volumes to a Cloud Foundry application</h3>

<p>List the available services:</p>

<pre><code>$&gt; cf services
Getting services in org system / space tmp as admin...

name                          service        plan      bound apps    last operation
eirini-persi-1                eirini-persi   default   dizzylizard   create succeeded
</code></pre>

<p>Let&rsquo;s associate the service to an application (in this case <code>dizzylizard</code>) using <code>eirini-persi-1</code>:</p>

<pre><code>$&gt; cf bind-service dizzylizard eirini-persi-1

Binding service eirini-persi-1 to app dizzylizard in org system / space tmp as admin...
OK

</code></pre>

<p>Restage our app so our change takes effect:</p>

<pre><code>$&gt; cf restage dizzylizard

Restaging app dizzylizard in org system / space tmp as admin...
</code></pre>

<h3 id="access-the-volume">Access the Volume</h3>

<p>Once the service is associated, the application can access to the data of the volume mount by reading the mounted path inside the <code>VCAP_SERVICES</code> environment variable.</p>

<p>An example of <code>VCAP_SERVICES</code> generated by <code>eirini-persi-broker</code>:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{<span style="color:#6ab825;font-weight:bold">&#34;eirini-persi&#34;</span>: [	  {
		<span style="color:#6ab825;font-weight:bold">&#34;credentials&#34;</span>: { <span style="color:#6ab825;font-weight:bold">&#34;volume_id&#34;</span>: <span style="color:#ed9d13">&#34;the-volume-id&#34;</span> },
		<span style="color:#6ab825;font-weight:bold">&#34;label&#34;</span>: <span style="color:#ed9d13">&#34;eirini-persi&#34;</span>,
		<span style="color:#6ab825;font-weight:bold">&#34;name&#34;</span>: <span style="color:#ed9d13">&#34;my-instance&#34;</span>,
		<span style="color:#6ab825;font-weight:bold">&#34;plan&#34;</span>: <span style="color:#ed9d13">&#34;hostpath&#34;</span>,
		<span style="color:#6ab825;font-weight:bold">&#34;tags&#34;</span>: [
			<span style="color:#ed9d13">&#34;erini&#34;</span>,
			<span style="color:#ed9d13">&#34;kubernetes&#34;</span>,
			<span style="color:#ed9d13">&#34;storage&#34;</span>
		],
		<span style="color:#6ab825;font-weight:bold">&#34;volume_mounts&#34;</span>: [
		  {
			<span style="color:#6ab825;font-weight:bold">&#34;container_dir&#34;</span>: <span style="color:#ed9d13">&#34;/var/vcap/data/de847d34-bdcc-4c5d-92b1-cf2158a15b47&#34;</span>,
			<span style="color:#6ab825;font-weight:bold">&#34;device_type&#34;</span>: <span style="color:#ed9d13">&#34;shared&#34;</span>,
			<span style="color:#6ab825;font-weight:bold">&#34;mode&#34;</span>: <span style="color:#ed9d13">&#34;rw&#34;</span>
		  }
		]
	  }
	]
}</code></pre></div>
<p>You can refer to the <a href="https://docs.cloudfoundry.org/devguide/services/using-vol-services.html" target="_blank">Cloud Foundry documentation regarding of how to access to the Volume Service</a>, with the difference that the eirini broker will create services with the id <code>eirini-persi</code>.</p>

<h2 id="see-also">See also</h2>

<ul>
<li><a href="https://github.com/SUSE/scf/wiki/Persistence-with-Eirini-in-SCF" target="_blank">https://github.com/SUSE/scf/wiki/Persistence-with-Eirini-in-SCF</a></li>
</ul>

	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified September 2, 2020: <a  href="https://github.com/cloudfoundry-incubator/kubecf-docs/commit/6026ab2a85af4a8049d7679b438d4e2cb6784b83">Add docs for eirini-persi (6026ab2)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/cloudfoundry-incubator/kubecf">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://cloudfoundry.slack.com/archives/CQ2U3L6DC">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2020 CloudFoundry.org Foundation, Inc. All Rights Reserved</small>
        <small class="ml-1"><a href="https://www.cloudfoundry.org/privacy-policy/" target="_blank">Privacy Policy</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>













<script src="/js/main.min.460c8ae21829f9b330823a08f34ac961d7d0daa8874c8c9eba7ea0484bb42a79.js" integrity="sha256-RgyK4hgp&#43;bMwgjoI80rJYdfQ2qiHTIyeun6gSEu0Knk=" crossorigin="anonymous"></script>




  </body>
</html>
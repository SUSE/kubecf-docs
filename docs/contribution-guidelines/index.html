<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.57.2" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">

<link rel="alternate" type="application/rss&#43;xml" href="https://kubecf.io/docs/contribution-guidelines/index.xml">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Contribution Guidelines | KubeCF</title><meta property="og:title" content="Contribution Guidelines" />
<meta property="og:description" content="How to contribute to kubecf
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://kubecf.io/docs/contribution-guidelines/" />
<meta property="og:site_name" content="KubeCF" />
<meta itemprop="name" content="Contribution Guidelines">
<meta itemprop="description" content="How to contribute to kubecf
">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Contribution Guidelines"/>
<meta name="twitter:description" content="How to contribute to kubecf
"/>







<link rel="preload" href="/scss/main.min.a267473c50c1e3a3a293c7356bde2df7ef31dc904e49772ce6366a3703594ac5.css" as="style">
<link href="/scss/main.min.a267473c50c1e3a3a293c7356bde2df7ef31dc904e49772ce6366a3703594ac5.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1071.73 221.27"><defs><linearGradient id="a" x1="-424.28" y1="-348.73" x2="-423.28" y2="-348.73" gradientTransform="matrix(297.1, 0, 0, -297.1, 126823.42, -103498.81)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00b1e1"/><stop offset="1" stop-color="#2c75ba"/></linearGradient></defs><title>Asset 4</title><path d="M128.57 217.38 62.99 130.7 46.1 150.82v66.56H0V.83H46.1V97.58L122.72.83H179.54L93.5 102.45 185.38 217.38H128.57z"/><path d="M290.79 217.38v-19.8c-10.71 12-29.54 23.69-55.19 23.69-34.42.0-50.65-18.82-50.65-49.34V60.57h41.24v95.12c0 21.76 11.36 28.9 28.89 28.9 15.91.0 28.57-8.77 35.71-17.86V60.57H332V217.38z"/><path d="M358 217.38V.83h41.24V80.7c12.33-15.91 29.86-24 48.37-24 39.93.0 69.48 31.17 69.48 82.47.0 52.27-29.87 82.13-69.48 82.13-18.83.0-36-8.44-48.37-24v20.13zm76.62-32.79c24 0 39.94-18.18 39.94-45.45s-15.91-45.78-39.94-45.78c-13.31.0-28.57 7.79-35.38 18.18v55.52C406 177.12 421.3 184.59 434.61 184.59z"/><path d="M525.51 138.81c0-45.45 33.44-82.14 81.17-82.14 46.75.0 78.56 35.07 78.56 86.36v9.09H568.69c2.6 19.81 18.51 36.36 45.13 36.36 13.31.0 31.82-5.84 41.88-15.58l18.18 26.62c-15.58 14.29-40.25 21.75-64.61 21.75C561.55 221.27 525.51 189.13 525.51 138.81zm81.17-49.35C581 89.46 570 108.62 568 124.2h77.27C644.34 109.27 634 89.46 606.68 89.46z"/><path d="M964.59 87.19V74.01 41.42H1071.73V.83H918.49V217.38H964.59V175.15 127.78 87.19z"/><path d="M1041.05 90l-23.77-18.87V90h-139a45.54 45.54.0 0 1-31.52-12.64c-.48-.45-1-.91-1.42-1.39a45.78 45.78.0 1 0 0 66.27c.46-.47.94-.93 1.42-1.39a45.59 45.59.0 0 1 31.52-12.64h139v18.87l23.77-18.87 24.07-19.1z" fill="url(#a)"/><path d="M868.23 146A65.12 65.12.0 1 1 868 72.22L907.56 51.6a110.68 110.68.0 0 0-19.67-23.52c-.61.42-1.23.82-1.88 1.18A23.68 23.68.0 0 1 850.85 6.08a110 110 0 0 0-16.21-4.34A112 112 0 0 0 820.33.0c-.17.6-.36 1.19-.58 1.78a23.69 23.69.0 0 1-30.52 13.81 23.6 23.6.0 0 1-11.62-9.44 110.35 110.35.0 0 0-27.46 14.39 25.32 25.32.0 0 1 1.18 2.77 23.68 23.68.0 0 1-31.21 29.81 109.19 109.19.0 0 0-12 28.55 23.7 23.7.0 0 1 12.95 34.57 23.6 23.6.0 0 1-15.21 11 109.48 109.48.0 0 0 9.38 29.88 23.69 23.69.0 0 1 28.5 36.76 108.8 108.8.0 0 0 27 16.67 23.68 23.68.0 0 1 45.87 9 109.18 109.18.0 0 0 31.26-5.21 23.68 23.68.0 0 1 40.22-23.2 109.46 109.46.0 0 0 20-24c-.48-.35-.93-.76-1.39-1.15z"/></svg></span><span class="text-uppercase font-weight-bold">KubeCF</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/community/" ><span>Community</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.0c16d5dda83858387961fff0fdd04eea2dd091fbd4685190da1ead1b849e0a2e5b0eb259805ed2764676f516a9d1e44fd1c996a619743eac45ef1a3f45ffabbc.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.0c16d5dda83858387961fff0fdd04eea2dd091fbd4685190da1ead1b849e0a2e5b0eb259805ed2764676f516a9d1e44fd1c996a619743eac45ef1a3f45ffabbc.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/overview/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Overview</a>
  </li>
  <ul>
    <li class="collapse " id="docs-overview">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/deployment/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Deploying KubeCF</a>
  </li>
  <ul>
    <li class="collapse " id="docs-deployment">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-deployment-kubernetes-deploy" href="/docs/deployment/kubernetes-deploy/">Deployment Walkthrough</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-deployment-advanced-topics" href="/docs/deployment/advanced-topics/">Advanced Topics</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-deployment-affinities-and-tolerations" href="/docs/deployment/affinities-and-tolerations/">Affinities and Tolerations</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/concepts/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Concepts</a>
  </li>
  <ul>
    <li class="collapse " id="docs-concepts">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-concepts-operator" href="/docs/concepts/operator/">Operator</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-concepts-quarks" href="/docs/concepts/quarks/">Quarks</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tasks/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Core Tasks</a>
  </li>
  <ul>
    <li class="collapse " id="docs-tasks">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tasks-upgrade" href="/docs/tasks/upgrade/">KubeCF Upgrades</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tasks-deploy" href="/docs/tasks/deploy/">KubeCF Deployment guidelines</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tasks-secrets" href="/docs/tasks/secrets/">KubeCF and Secrets</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tasks-bosh" href="/docs/tasks/bosh/">Test BOSH Releases</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tutorials/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Tutorials</a>
  </li>
  <ul>
    <li class="collapse " id="docs-tutorials">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-deploy-k3s" href="/docs/tutorials/deploy-k3s/">Deploy KubeCF on K3s</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-deploy-kind" href="/docs/tutorials/deploy-kind/">Deploy KubeCF on Kind</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-eirini-persi" href="/docs/tutorials/eirini_persi/">Eirini Persistence broker</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-deploy-stratos" href="/docs/tutorials/deploy-stratos/">Deploy Stratos next to KubeCF</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-bosh-integration" href="/docs/tutorials/bosh-integration/">Bosh releases integration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-deploy-minikube" href="/docs/tutorials/deploy-minikube/">Deploy KubeCF in Minikube</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-tutorials-run-smoke-tests" href="/docs/tutorials/run-smoke-tests/">Run smoke tests</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/reference/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Reference</a>
  </li>
  <ul>
    <li class="collapse " id="docs-reference">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docs-reference-tests" href="/docs/reference/tests/">Tests</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/contribution-guidelines/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Contribution Guidelines</a>
  </li>
  <ul>
    <li class="collapse show" id="docs-contribution-guidelines">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            






<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">





<a href="https://github.com/cloudfoundry-incubator/kubecf-docs/edit/master/content/en/docs/Contribution%20guidelines/_index.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudfoundry-incubator/kubecf-docs/issues/new?title=Contribution%20Guidelines" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/cloudfoundry-incubator/kubecf/issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>

</div>






<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#table-of-contents-aspects">Table of Contents (Aspects)</a></li>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#pull-requests">Pull Requests</a></li>
<li><a href="#source-organization">Source Organization</a></li>
<li><a href="#updating-subcharts">Updating subcharts</a></li>
<li><a href="#docker-images">Docker Images</a></li>
<li><a href="#linting">Linting</a></li>
<li><a href="#patching">Patching</a>
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#customization">Customization</a></li>
<li><a href="#patches">Patches</a></li>
</ul></li>
<li><a href="#rotating-secrets">Rotating Secrets</a></li>
</ul></li>
</ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		







<li class="breadcrumb-item" >
	<a href="https://kubecf.io/docs/">Documentation</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://kubecf.io/docs/contribution-guidelines/">Contribution Guidelines</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Contribution Guidelines</h1>
        <div class="lead">How to contribute to kubecf</div>
	
	



<div class="pageinfo pageinfo-primary">
<p>The intended audience of this document are developers wishing to
contribute to the Kubecf project.</p>

<p>It provides a basic overview of various aspects of the project below,
and uses these overviews as the launching points to other documents
which go deeper into the details of each aspect.</p>

</div>


<h2 id="table-of-contents-aspects">Table of Contents (Aspects)</h2>

<ul>
<li><a href="#deployment">Deployment</a></li>
<li><a href="#pull-requests">Pull Requests</a></li>
<li><a href="#source-organization">Source Organization</a></li>
<li><a href="#updating-subcharts">Updating Subcharts</a></li>
<li><a href="#docker-images">Docker Images</a></li>
<li><a href="#linting">Linting</a></li>
<li><a href="#patching">Patching</a></li>
<li>[BOSH Development Workflow]</li>
<li><a href="#rotating-secrets">Rotating secrets</a></li>
</ul>

<h2 id="deployment">Deployment</h2>

<p>Kubecf is built on top of a number of technologies, namely Kubernetes,
Helm (charts), and the <a href="for the translation of BOSH
deployments into Kubernetes objects" target="_blank">cf-operator</a>.</p>

<p>For all these we have multiple choices for installing them, and
various interactions between the choices influence the details of the
commands to use.</p>

<p>Instead of trying to document all the possibilities and all their
interactions at once, supporting documents will describe specific
combinations of choices in detail, from the bottom up.</p>

<table>
<thead>
<tr>
<th>Document</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><a href="dev/minikube.md" target="_blank">Local Minikube</a></td>
<td>Minikube + Operator + Kubecf</td>
</tr>

<tr>
<td><a href="dev/general.md" target="_blank">General Kube</a></td>
<td>Any Kube + Operator/Helm + Kubecf/Helm</td>
</tr>
</tbody>
</table>

<h2 id="pull-requests">Pull Requests</h2>

<p>The general work flow for pull requests contributing bug fixes,
features, etc. is:</p>

<ul>
<li><p>Branch or Fork the <strong>cloudfoundry-incubator/kubecf</strong> repository, depending on
permissions.</p></li>

<li><p>Implement the bug fix, feature, etc. on that branch/fork.</p></li>

<li><p>Submit a pull request based on the branch/fork through the github
web interface, against the <strong>master</strong> branch.</p></li>

<li><p>Developers will review the content of the pull request, asking
questions, requesting changes, and generally discussing the
submission with the submitter and among themselves.</p></li>

<li><p>PRs from branches of this repository are automatically tested <a href="https://concourse.suse.dev/teams/main/pipelines/kubecf" target="_blank">in the CI</a>.
For forks, you should ask a maintainer of this repository to trigger a build. Automated triggers have been disabled for security reasons.</p></li>

<li><p>After all issues with the request are resolved, and CI has passed,
a developer will merge it into master.</p></li>

<li><p>Note that it may be necessary to rebase the branch/fork to resolve
any conflicts due to other PRs getting merging while the PR is
under discussion.</p>

<p>Such a rebase will be a change request from the developers to the
contributor, on the assumption that the contributor is best suited
to resolving the conflicts.</p></li>
</ul>

<h2 id="source-organization">Source Organization</h2>

<p>The important directories of the kubecf sources, and their contents
are shown in the table below. Each directory entry links to the
associated documentation, if we have any.</p>

<table>
<thead>
<tr>
<th>Directory</th>
<th>Content</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>top</strong></td>
<td>Documentation entrypoint, License,</td>
</tr>

<tr>
<td></td>
<td>Main workspace definitions.</td>
</tr>

<tr>
<td><strong>top</strong>/&hellip;/README.md</td>
<td>Directory-specific local documentation.</td>
</tr>

<tr>
<td><a href="../bosh/releases/pre_render_scripts/README.md"><strong>top</strong>/bosh/releases</a></td>
<td>Support for runtime patches of a kubecf deployment.</td>
</tr>

<tr>
<td><strong>top</strong>/doc</td>
<td>Global documentation.</td>
</tr>

<tr>
<td><a href="cf_deployment/bump.md" target="_blank"><strong>top</strong>/dev/cf_deployment/bump</a></td>
<td>Tools to support updating the cf deployment</td>
</tr>

<tr>
<td></td>
<td>manifest used by kubecf.</td>
</tr>

<tr>
<td><a href="cf_cli.md" target="_blank"><strong>top</strong>/dev/cf_cli</a></td>
<td>Deploy cf cli into a helper pod from which to then</td>
</tr>

<tr>
<td></td>
<td>inspect the deployed Kubecf</td>
</tr>

<tr>
<td><a href="inspection.md" target="_blank"><strong>top</strong>/dev/kube</a></td>
<td>Tools to inspect kube clusters and kubecf deployments.</td>
</tr>

<tr>
<td><a href="../dev/kubecf/README.md"><strong>top</strong>/dev/kubecf</a></td>
<td>Kubecf chart configuration</td>
</tr>

<tr>
<td><strong>top</strong>/deploy/helm/kubecf</td>
<td>Templates and assets wrapping a CF deployment</td>
</tr>

<tr>
<td></td>
<td>manifest into a helm chart.</td>
</tr>

<tr>
<td><strong>top</strong>/rules</td>
<td>Supporting scripts.</td>
</tr>

<tr>
<td><a href="tests.md" target="_blank"><strong>top</strong>/testing</a></td>
<td>Scripts with specific testing</td>
</tr>

<tr>
<td><a href="../scripts/README.md"><strong>top</strong>/scripts</a></td>
<td>Developer scripts used by make to start a k8s cluster</td>
</tr>

<tr>
<td></td>
<td>(for example on kind), lint, build, run &amp; test kubecf</td>
</tr>

<tr>
<td><a href="../scripts/tools/README.md"><strong>top</strong>/scripts/tools</a></td>
<td>Developer scripts pinning the development dependencies</td>
</tr>
</tbody>
</table>

<h2 id="updating-subcharts">Updating subcharts</h2>

<p>The kubecf helm chart includes a number of subcharts. They are declared in
<a href="../deploy/helm/kubecf/requirements.yaml">requirements.yaml</a>. For the
convenience of development they are included in unpacked form directly in
this repo, so version changes can be inspected with regular <code>git</code> tools,
and the subcharts can be searched with <code>grep</code> etc.</p>

<p>The procedure to update the version of a subchart is:</p>

<pre><code>vi deploy/helm/kubecf/requirements.yaml
./dev/helm/update_subcharts.sh
git commit
</code></pre>

<h2 id="docker-images">Docker Images</h2>

<p>The docker images used by kubecf to run jobs in container use a
moderately complex naming scheme.</p>

<p>This scheme is explained in a separate document:
<a href="dev/image-naming.md" target="_blank">The Naming Of Docker Images in kubecf</a>.</p>

<h2 id="linting">Linting</h2>

<p>Currently, 3 linters are available: shellcheck, yamllint, &amp; helm linting.</p>

<p>Invoke these linters with</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">make lint</code></pre></div>
<p>to run shellcheck on all <code>.sh</code> files found in the entire checkout, or yamllint
on all <code>.yaml</code> or <code>.yml</code> files respectively, and report any issues found.  The
last option runs <code>helm lint</code> (without <code>--strict</code>) on the generated helm chart.</p>

<p>See the authoritative list of linters being called in the <code>make lint</code> target.</p>

<h2 id="patching">Patching</h2>

<h3 id="background">Background</h3>

<p>The main goal of the CF operator is to take a BOSH deployment
manifest, deploy it, and have it run as-is.</p>

<p>Naturally, in practice, this goal is not quite reached yet, requiring
patching of the deployment manifest in question, and/or the
involved releases, at various points of the deployment process. The
reason behind a patch is generally fixing a problem, whether it be
from the translation into the kube environment, an issue with an
underlying component, or something else.</p>

<p>Then, there are features, given the user of the helm chart wrapped
around the deployment manifest the ability to easily toggle various
preset configurations, for example the use of eirini instead of diego
as the application scheduler.</p>

<h3 id="features">Features</h3>

<p>A feature of kubecf is usually implemented using a combination of
<a href="https://helm.sh/docs/chart_template_guide/" target="_blank">Helm templating</a> and <a href="https://bosh.io/docs/cli-ops-files/" target="_blank">BOSH ops files</a>.</p>

<p>The helm templating is used to translate the properties in the chart&rsquo;s
values.yaml to the actual actions to take, by including/excluding
chart elements, often the BOSH ops files containing the structured
patches modifying the deployment itself (changing properties,
adding/removing releases, (de)activating jobs, etc.)</p>

<p>The helm templating is applied when the kubecf chart is deployed.</p>

<p>The ops files are then applied by the operator, transforming the base
manifest from the chart into the final manifest to deploy.</p>

<h3 id="customization">Customization</h3>

<p>Kubecf provides two mechanisms for customization during development
(and maybe by operators ?):</p>

<ol>
<li><p>The property <code>.Values.operations.custom</code> of the chart is a list
 of names for kube configmaps containing the texts of the ops
 files to apply beyond the ops files from the chart itself.</p>

<p>Note that we are talking here about a yaml structure whose
 <code>data.ops</code> property is a <strong>text block</strong> holding the yaml
 structure of an ops file.</p>

<p>There is no tooling to help the writer with the ensuing quoting
 hell.</p>

<p>Note further that the resulting config maps have to be applied,
 i.e. uploaded into the kube cluster <strong>before</strong> deploying the
 kubecf helm chart with its modified values.yaml.</p>

<p>For example, <code>kubectl apply</code> the object below</p>

<pre><code> ```yaml
 ---
 apiVersion: v1
 kind: ConfigMap
 metadata:
   name: configmap_name
 data:
   ops: |-
     some_random_ops
 ```
</code></pre>

<p>and then use</p>

<pre><code> ```yaml
 operations:
   custom:
   - configmap_name
 ```
</code></pre>

<p>in the values.yaml (or an equivalent <code>--set</code> option) as part of a
 kubecf deployment to include that ops file in the deployment.</p>

<p>The [BOSH Development Workflow] is an example of its use.</p>

<p>[BOSH Development Workflow]: bosh-release-development.md</p></li>

<li><p>The second mechanism allows the specification of any custom BOSH
 property for any instancegroup and job therein.</p>

<p>Just specifying</p>

<pre><code> ```yaml
 properties:
   instance-group-name:
     job-name:
       some-property: some-value
 ```
</code></pre>

<p>in the values.yaml for the kubecf chart causes the chart to
 generate and use an ops file which applies the assignment of
 <code>some-value</code> to <code>some-property</code> to the specified instance group
 and job during deployment.</p>

<p>An example of its use in Kubecf is limiting the set of test
 suites executed by the <a href="tests_cat.md" target="_blank">CF acceptance tests</a>.</p></li>
</ol>

<p>Both forms of customization assume a great deal of familiarity on the
part of the developer and/or operator with the BOSH releases, instance
groups and jobs underlying the CF deployment manifest, i.e. which
properties exist, what changes to them mean and how they affect the
system.</p>

<h3 id="patches">Patches</h3>

<p>In SCF v2, the predecessor to kubecf, the <a href="https://github.com/SUSE/scf/tree/develop/container-host-files/etc/scf/config/scripts/patches" target="_blank">patches</a> scripts enabled
developers and maintainers to apply general patches to the sources of
a job (i.e. configuration templates, script sources, etc.) before that
job was rendered and then executed. At the core, the feature allows
the user to execute custom scripts during runtime of the job container
for a specific instance_group.</p>

<p><a href="https://github.com/cloudfoundry-incubator/cf-operator/blob/master/docs/from_bosh_to_kube.md#Pre_render_scripts" target="_blank">Pre render scripts</a> are the equivalent feature of the CF operator.</p>

<p>Kubecf makes use of this feature to fix a number of issues in the
deployment. The relevant patch scripts are found under the directory
<code>bosh/releases/pre_render_scripts</code>.</p>

<p>When following the directory structure explained by the
<a href="pre-render-scripts.md" target="_blank">README</a>, the bazel machinery for generating
the kubecf helm chart will automatically convert these scripts into
the proper ops files for use by the CF operator.</p>

<p><strong>Attention</strong> All patch scripts must be idempotent. In other words, it
must be possible to apply them multiple times without error and
without changing the result.</p>

<p>The existing patch scripts do this by checking if the patch is already
applied before attempting to apply it for real.</p>

<h2 id="rotating-secrets">Rotating Secrets</h2>

<p><strong>Rotating secrets</strong> is in general the process of updating one or more
secrets to new values and restarting all affected pods so that they
will use these new values.</p>

<p>Most of the process is automatic. How to trigger it is explained
in <a href="secret_rotation.md" target="_blank">Secret Rotation</a>.</p>

<p>Beyond this, the keys used to encrypt the Cloud Controller Database
(CCDB) can also be rotated, however, they do not exist as general
secrets of the KubeCF deployment. This means that the general process
explained above <strong>does not apply</strong> to them.</p>

<p>Their custom process is explained in
<a href="encryption_key_rotation.md" target="_blank">CCDB encryption key rotation</a>.</p>

        <div class="section-index">
    
    
    
    
    <hr class="panel-line">
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
</div>

	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified October 1, 2020: <a  href="https://github.com/cloudfoundry-incubator/kubecf-docs/commit/a873a2ebe2dfea2c27fd5800c7a0095090f4678b">Some minor changes to contributing content. (a873a2e)</a>
</div>
</div>

          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/cloudfoundry-incubator/kubecf">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://cloudfoundry.slack.com/archives/CQ2U3L6DC">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2020 CloudFoundry.org Foundation, Inc. All Rights Reserved</small>
        <small class="ml-1"><a href="https://www.cloudfoundry.org/privacy-policy/" target="_blank">Privacy Policy</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>













<script src="/js/main.min.460c8ae21829f9b330823a08f34ac961d7d0daa8874c8c9eba7ea0484bb42a79.js" integrity="sha256-RgyK4hgp&#43;bMwgjoI80rJYdfQ2qiHTIyeun6gSEu0Knk=" crossorigin="anonymous"></script>




  </body>
</html>